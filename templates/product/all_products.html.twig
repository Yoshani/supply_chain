{% extends 'base.html.twig' %}

{% block title %}Product index{% endblock %}


{% block stylesheets %}
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
{% endblock %}

{% block body %}
{% apply inline_css %}

<html>
<style>
.products {
    display:grid;
    grid-template-columns: repeat(4, 1fr);
    grid-gap: 5px;
    
    flex:1 1 auto;
}

.card {
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
  height: 400px;
  width: 250px;
  margin: auto;
  text-align: center;
  font-family: arial;
  padding-bottom: 20px;
}

.imagecard {
  height: 250px;
  width: 230px;
  margin: auto;
}

.textcard{
  height: 150px;
  width: 230px;
  margin: auto;
  text-align: center;
  font-family: arial;
  padding-bottom: 20px;
}

.price {
  color: grey;
  font-size: 22px;
}

.card button {
  border: none;
  outline: 0;
  padding: 12px;
  color: white;
  background-color: #002752;
  text-align: center;
  cursor: pointer;
  width: 100%;
  font-size: 18px;
}

.card button:hover {
  opacity: 0.7;
}
</style>


<body>

<a href="{{ path('cart') }}" ><button>cart</button></a>

<h2 style="padding-left:180px; padding-top:20px">Products</h2>

<div style="padding-top:50px; padding-bottom:50px; padding-left: 150px; padding-right:150px">
<div class="products">
{% for product in products %}
    {% set arr = [product.id,product.name] %}
    {% set foo = { details: arr} %}

    <div class="card">
    <box class="imagecard">
    <img height=220px src="/images/{{ product.picture }}" alt="product image" style="width:100%">
    </box>
    <div class="textcard">
    <h5>{{ product.name }}</h5>
    <p class="price">{{ product.unitPrice }}</p>
    <p><button onclick="addItem({{product.id}}, '{{product.name}}',{{product.unitPrice}}, '{{product.picture}}')" >Add to Cart</button></p>
    </div>
    </div>

{% endfor %}

    <p id="user" style="display:none">{{ app.user }}</p>
  {% if app.user %}
    <p id="customerId" style="display:none">{{ app.user.id }}</p>
  {% endif %}

</div>

</div>
</div>

</body>  

</html>
{% endapply %}

<script>


  function addItem(id, name, unitPrice, picture){

    var userid = document.getElementById("user").innerHTML;


    if(userid===""){
      alert("you have to log in first");
    }

    else{
    var customerID = document.getElementById("customerId").innerHTML;
    var productDetails = {id:id , name:name , unitPrice:unitPrice, picture:picture};
    var name = "cartKeyOf:"
    var key = name.concat(customerID);

    contents = [];

    let _contents = localStorage.getItem(key);
    if(_contents){
      contents = JSON.parse(_contents);
    }
    
    contents.push(productDetails);
    let _cart = JSON.stringify(contents);
    localStorage.setItem(key, _cart);
    alert("Added to cart");
    }
    
    return false;
  }



</script>

{% endblock %}

